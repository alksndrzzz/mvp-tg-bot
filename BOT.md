# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Telegram –±–æ—Ç–∞ –¥–ª—è –≤–æ–¥–∏—Ç–µ–ª–µ–π

## –û–±–∑–æ—Ä

Telegram –±–æ—Ç –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –≤–æ–¥–∏—Ç–µ–ª–µ–π. –ë–æ—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—è–º –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å–∞–º–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤.

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Node.js
- Telegraf (Telegram Bot API)
- Supabase (PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- node-cron (–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á)

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------------|----------|--------|
| `BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ –æ—Ç @BotFather | `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz` |
| `SUPABASE_URL` | URL –ø—Ä–æ–µ–∫—Ç–∞ Supabase | `https://xxxxx.supabase.co` |
| `SUPABASE_ANON_KEY` | –ê–Ω–æ–Ω–∏–º–Ω—ã–π –∫–ª—é—á Supabase | `eyJhbGci...` |

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|------------|----------|----------------------|----------------|
| `ADMIN_CHAT_ID` | Telegram chat_id –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ | - | –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –ª–æ–∫–∞—Ü–∏—è—Ö –≤–æ–¥–∏—Ç–µ–ª–µ–π |
| `TZ` | –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –¥–ª—è cron –∑–∞–¥–∞—á | `Europe/Vilnius` | –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á —Å —É—á–µ—Ç–æ–º —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ |
| `SUPABASE_ANON_KEY` | –ê–Ω–æ–Ω–∏–º–Ω—ã–π –∫–ª—é—á (fallback) | –•–∞—Ä–¥–∫–æ–¥ –≤ `lib/supabase.js` | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω –≤ env |

### –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

```javascript
// –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ dotenv —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ñ–∞–π–ª .env —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
require('dotenv').config({ override: false });
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `drivers`

–û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤–æ–¥–∏—Ç–µ–ª–µ–π.

**–ö–æ–ª–æ–Ω–∫–∏:**
- `id` (UUID, PK) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `name` (TEXT, NOT NULL) - –∏–º—è –≤–æ–¥–∏—Ç–µ–ª—è
- `token` (TEXT, NOT NULL, UNIQUE) - —Ç–æ–∫–µ–Ω –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ deep link
- `telegram_chat_id` (BIGINT, nullable) - ID —á–∞—Ç–∞ –≤ Telegram
- `is_active` (BOOLEAN, default: false) - –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ –≤–æ–¥–∏—Ç–µ–ª—å
- `route_status` (TEXT, default: 'not-started-yet') - —Å—Ç–∞—Ç—É—Å –º–∞—Ä—à—Ä—É—Ç–∞
  - –í–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: `'not-started-yet'`, `'in-progress'`, `'stopped'`
- `last_reminded_date` (DATE, nullable) - –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
- `reminder_start_date` (DATE, nullable) - –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π (legacy)
- `reminder_end_date` (DATE, nullable) - –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π (legacy)
- `journey_start_date` (DATE, nullable) - –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –ø–æ–µ–∑–¥–∫–∏
- `journey_end_date` (DATE, nullable) - –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–µ–∑–¥–∫–∏
- `phone_number` (TEXT, nullable) - –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- `created_at` (TIMESTAMPTZ, default: now()) - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- `updated_at` (TIMESTAMPTZ, default: now()) - –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ò–Ω–¥–µ–∫—Å—ã:**
- `drivers_pkey` - –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ `id`
- `drivers_token_key` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ `token`
- `idx_drivers_telegram_chat_id` - –∏–Ω–¥–µ–∫—Å –Ω–∞ `telegram_chat_id`
- `idx_drivers_token` - –∏–Ω–¥–µ–∫—Å –Ω–∞ `token`
- `idx_drivers_route_status` - –∏–Ω–¥–µ–∫—Å –Ω–∞ `route_status`
- `idx_drivers_journey_end_date` - –∏–Ω–¥–µ–∫—Å –Ω–∞ `journey_end_date`

### –¢–∞–±–ª–∏—Ü–∞ `locations`

–ì–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –≤–æ–¥–∏—Ç–µ–ª–µ–π.

**–ö–æ–ª–æ–Ω–∫–∏:**
- `id` (UUID, PK) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `driver_id` (UUID, FK ‚Üí drivers.id) - ID –≤–æ–¥–∏—Ç–µ–ª—è
- `latitude` (NUMERIC(10, 8), NOT NULL) - —à–∏—Ä–æ—Ç–∞
- `longitude` (NUMERIC(11, 8), NOT NULL) - –¥–æ–ª–≥–æ—Ç–∞
- `created_at` (TIMESTAMPTZ, default: now()) - –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
- `captured_at` (TIMESTAMPTZ, default: now()) - –≤—Ä–µ–º—è –∑–∞—Ö–≤–∞—Ç–∞ –ª–æ–∫–∞—Ü–∏–∏

**–í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏:**
- `driver_id` ‚Üí `drivers.id` (ON DELETE CASCADE)

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_locations_driver_id` - –∏–Ω–¥–µ–∫—Å –Ω–∞ `driver_id`
- `idx_locations_created_at` - –∏–Ω–¥–µ–∫—Å –Ω–∞ `created_at DESC`

### –¢–∞–±–ª–∏—Ü–∞ `journey_notifications`

–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–µ–∑–¥–∫–∞—Ö.

**–ö–æ–ª–æ–Ω–∫–∏:**
- `id` (UUID, PK) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `driver_id` (UUID, FK ‚Üí drivers.id) - ID –≤–æ–¥–∏—Ç–µ–ª—è
- `notification_type` (TEXT, NOT NULL) - —Ç–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  - –í–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: `'ending_soon'`, `'ended'`
- `sent_at` (TIMESTAMPTZ, default: now()) - –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏
- `created_at` (TIMESTAMPTZ, default: now()) - –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è

**–í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏:**
- `driver_id` ‚Üí `drivers.id` (ON DELETE CASCADE)

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_journey_notifications_driver_id` - –∏–Ω–¥–µ–∫—Å –Ω–∞ `driver_id`
- `idx_journey_notifications_driver_type` - —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –Ω–∞ `(driver_id, notification_type)`
- `idx_journey_notifications_type` - –∏–Ω–¥–µ–∫—Å –Ω–∞ `notification_type`

### –¢–∞–±–ª–∏—Ü–∞ `admin_settings`

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

**–ö–æ–ª–æ–Ω–∫–∏:**
- `id` (UUID, PK) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `timezone` (TEXT, NOT NULL, default: 'Europe/Vilnius') - —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å –≤ —Ñ–æ—Ä–º–∞—Ç–µ IANA
- `created_at` (TIMESTAMPTZ, default: now()) - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- `updated_at` (TIMESTAMPTZ, default: now()) - –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –±–æ—Ç–µ:**
- `timezone` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ –∞–¥–º–∏–Ω–∞ (`getAdminTimezone()`)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞—Ç

### –¢–∞–±–ª–∏—Ü–∞ `users`

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ –±–æ—Ç–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞).

**–ö–æ–ª–æ–Ω–∫–∏:**
- `id` (UUID, PK, FK ‚Üí auth.users.id) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `email` (TEXT, NOT NULL) - email –∞–¥—Ä–µ—Å
- `role` (TEXT, NOT NULL, default: 'user') - —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –í–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: `'admin'`, `'user'`
- –î—Ä—É–≥–∏–µ –∫–æ–ª–æ–Ω–∫–∏ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –±–æ—Ç–µ)

## –ö–æ–º–∞–Ω–¥—ã –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

### `/start <token>`

–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–æ–¥–∏—Ç–µ–ª—è —á–µ—Ä–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `token` - —Ç–æ–∫–µ–Ω –≤–æ–¥–∏—Ç–µ–ª—è (–∏–∑ deep link –∏–ª–∏ –∞—Ä–≥—É–º–µ–Ω—Ç –∫–æ–º–∞–Ω–¥—ã)

**–õ–æ–≥–∏–∫–∞:**
1. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏–∑ `ctx.startPayload` –∏–ª–∏ `ctx.message.text`
2. –ü–æ–∏—Å–∫ –≤–æ–¥–∏—Ç–µ–ª—è –ø–æ —Ç–æ–∫–µ–Ω—É: `db.getDriverByToken(token)`
3. –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ —Ç–æ–∫–µ–Ω –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –º–∞—Ä—à—Ä—É—Ç–∞:
   - –ï—Å–ª–∏ `route_status = 'stopped'` –∏ –µ—Å—Ç—å –Ω–æ–≤—ã–µ –¥–∞—Ç—ã ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ `'not-started-yet'`
   - –ï—Å–ª–∏ `route_status = 'stopped'` –∏ –Ω–µ—Ç –Ω–æ–≤—ã—Ö –¥–∞—Ç ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–∞
5. –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª—è —Å Telegram: `db.linkDriverToTelegram(driver.id, ctx.from.id)`
6. –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:
   - –ï—Å–ª–∏ –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –º–∞—Ä—à—Ä—É—Ç–µ —Å –¥–∞—Ç–∞–º–∏
   - –ï—Å–ª–∏ –ø–µ—Ä–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ ‚Üí –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–ª—è –Ω–æ–≤–æ–π –ø–æ–µ–∑–¥–∫–∏
   - –ò–Ω–∞—á–µ ‚Üí –æ–±—ã—á–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ

**–í—ã–∑–æ–≤—ã –ë–î:**
- `db.getDriverByToken(token)` - SELECT –∏–∑ `drivers` WHERE `token = ?`
- `db.setDriverRouteStatus(driver.id, 'not-started-yet')` - UPDATE `drivers` SET `route_status`, `is_active`
- `db.linkDriverToTelegram(driver.id, ctx.from.id)` - UPDATE `drivers` SET `telegram_chat_id`

**–û—Ç–≤–µ—Ç—ã:**
- "–ù—É–∂–Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞. –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞." - —Ç–æ–∫–µ–Ω –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω
- "–°—Å—ã–ª–∫–∞ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞. –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –Ω–æ–≤—É—é —É –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞." - –≤–æ–¥–∏—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
- "–≠—Ç–∞ —Å—Å—ã–ª–∫–∞ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º..." - —Ç–æ–∫–µ–Ω –∑–∞–Ω—è—Ç
- "–°–ø–∞—Å–∏–±–æ, –º–∞—Ä—à—Ä—É—Ç –æ–∫–æ–Ω—á–µ–Ω..." - –º–∞—Ä—à—Ä—É—Ç –∑–∞–≤–µ—Ä—à–µ–Ω
- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏

### `/testadmin`

–¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–≤—è–∑–∏ —Å –∞–¥–º–∏–Ω-—á–∞—Ç–æ–º.

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è `ADMIN_CHAT_ID`
2. –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∞–¥–º–∏–Ω-—á–∞—Ç

**–í—ã–∑–æ–≤—ã –ë–î:** –ù–µ—Ç

### `/resetme`

–°–±—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞ –≤–æ–¥–∏—Ç–µ–ª—è (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏).

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–∏—Å–∫ –≤–æ–¥–∏—Ç–µ–ª—è –ø–æ chat_id: `db.getDriverByChatId(ctx.chat.id)`
2. –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –≤–æ–¥–∏—Ç–µ–ª—è: `db.setDriverInactive(ctx.chat.id)`
3. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞: `db.setDriverRouteStatus(driver.id, 'stopped')`

**–í—ã–∑–æ–≤—ã –ë–î:**
- `db.getDriverByChatId(ctx.chat.id)` - SELECT –∏–∑ `drivers` WHERE `telegram_chat_id = ?`
- `db.setDriverInactive(ctx.chat.id)` - UPDATE `drivers` SET `is_active = false`
- `db.setDriverRouteStatus(driver.id, 'stopped')` - UPDATE `drivers` SET `route_status = 'stopped'`, `is_active = false`

### `/whoami`

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç chat.id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏).

**–õ–æ–≥–∏–∫–∞:**
1. –û—Ç–ø—Ä–∞–≤–∫–∞ `ctx.chat.id` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–í—ã–∑–æ–≤—ã –ë–î:** –ù–µ—Ç

### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "‚úÖ –ú–∞—Ä—à—Ä—É—Ç –∑–∞–≤–µ—Ä—à—ë–Ω"

–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ –≤–æ–¥–∏—Ç–µ–ª–µ–º.

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–∏—Å–∫ –≤–æ–¥–∏—Ç–µ–ª—è: `db.getDriverByChatId(ctx.chat.id)`
2. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞: `endRoute(ctx.chat.id, driver.id, '–í–æ–¥–∏—Ç–µ–ª—å –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É...')`
3. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

**–í—ã–∑–æ–≤—ã –ë–î:**
- `db.getDriverByChatId(ctx.chat.id)` - SELECT –∏–∑ `drivers`
- `db.setDriverRouteStatus(driver.id, 'stopped')` - UPDATE `drivers` SET `route_status = 'stopped'`, `is_active = false`

**–û—Ç–≤–µ—Ç—ã:**
- "–í—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫ –≤–æ–¥–∏—Ç–µ–ª—å." - –≤–æ–¥–∏—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
- "–°–ø–∞—Å–∏–±–æ, –º–∞—Ä—à—Ä—É—Ç –æ–∫–æ–Ω—á–µ–Ω. –ï—Å–ª–∏ —á—Ç–æ - —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –ª–∏—á–Ω–æ –Ω–∞–ø—Ä—è–º—É—é." - —É—Å–ø–µ—Ö

### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ª–æ–∫–∞—Ü–∏–∏ (`BOT.on('location')`)

–û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –æ—Ç –≤–æ–¥–∏—Ç–µ–ª—è.

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–∏—Å–∫ –≤–æ–¥–∏—Ç–µ–ª—è: `db.getDriverByChatId(ctx.chat.id)`
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –º–∞—Ä—à—Ä—É—Ç–∞:
   - –ï—Å–ª–∏ `route_status = 'stopped'` –∏ –µ—Å—Ç—å –Ω–æ–≤—ã–µ –¥–∞—Ç—ã ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
   - –ï—Å–ª–∏ `route_status = 'stopped'` –∏ –Ω–µ—Ç –Ω–æ–≤—ã—Ö –¥–∞—Ç ‚Üí –æ—Ç–∫–∞–∑ –≤ –ø—Ä–∏–µ–º–µ –ª–æ–∫–∞—Ü–∏–∏
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞: `db.isNewRoute(driver)` ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–≤–æ–π –ª–æ–∫–∞—Ü–∏–∏: `db.hasLocations(driver.id)` ‚Üí –∞–∫—Ç–∏–≤–∞—Ü–∏—è –≤–æ–¥–∏—Ç–µ–ª—è
5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–µ–∑–¥–∫–∏ (–≤ —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ –∞–¥–º–∏–Ω–∞)
6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏: `db.saveLocation(driverId, lat, lon)`
7. –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω—É (–µ—Å–ª–∏ `ADMIN_CHAT_ID` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
8. –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª—é

**–í—ã–∑–æ–≤—ã –ë–î:**
- `db.getDriverByChatId(ctx.chat.id)` - SELECT –∏–∑ `drivers`
- `db.setDriverRouteStatus(driver.id, 'not-started-yet')` - UPDATE `drivers` (–µ—Å–ª–∏ –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç)
- `db.hasLocations(driver.id)` - SELECT COUNT –∏–∑ `locations` WHERE `driver_id = ?`
- `db.activateDriver(driver.id, ctx.from.id)` - UPDATE `drivers` SET `route_status = 'in-progress'`, `is_active = true`
- `db.getTodayInAdminTimezone()` - SELECT `timezone` –∏–∑ `admin_settings`
- `db.saveLocation(driverId, lat, lon)` - INSERT –≤ `locations`
- `endRoute()` ‚Üí `db.setDriverRouteStatus()` - UPDATE `drivers` (–µ—Å–ª–∏ –¥–∞—Ç–∞ –∏—Å—Ç–µ–∫–ª–∞)

**–ó–∞–ø–∏—Å—å –≤ –ë–î:**
```sql
INSERT INTO locations (driver_id, latitude, longitude, captured_at)
VALUES (?, ?, ?, now());
```

**–û—Ç–≤–µ—Ç—ã:**
- "–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω. –ó–∞–π–¥–∏—Ç–µ –ø–æ —Å–≤–æ–µ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ." - –≤–æ–¥–∏—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
- "–°–ø–∞—Å–∏–±–æ, –º–∞—Ä—à—Ä—É—Ç –æ–∫–æ–Ω—á–µ–Ω..." - –º–∞—Ä—à—Ä—É—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- "üöó –£ –≤–∞—Å –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç!..." - –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω
- "‚úÖ –ì–µ–æ–ø–æ–∑–∏—Ü–∏—è –ø—Ä–∏–Ω—è—Ç–∞. –°–ø–∞—Å–∏–±–æ!" - —É—Å–ø–µ—Ö

### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (`BOT.on('text')`)

–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–µ –∫–æ–º–∞–Ω–¥—ã –∏ –Ω–µ –∫–Ω–æ–ø–∫–∏).

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–ø—É—Å–∫ –∫–æ–º–∞–Ω–¥ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `/`)
2. –ü—Ä–æ–ø—É—Å–∫ –∫–Ω–æ–ø–∫–∏ "‚úÖ –ú–∞—Ä—à—Ä—É—Ç –∑–∞–≤–µ—Ä—à—ë–Ω"
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤–æ–¥–∏—Ç–µ–ª—è: `db.getDriverByChatId(ctx.chat.id)`
4. –ï—Å–ª–∏ –≤–æ–¥–∏—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω ‚Üí –ø—Ä–æ—Å—å–±–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–µ–æ–ø–æ–∑–∏—Ü–∏—é
5. –ï—Å–ª–∏ –≤–æ–¥–∏—Ç–µ–ª—å –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω ‚Üí –º–æ–ª—á–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º

**–í—ã–∑–æ–≤—ã –ë–î:**
- `db.getDriverByChatId(ctx.chat.id)` - SELECT –∏–∑ `drivers`

**–û—Ç–≤–µ—Ç—ã:**
- "–≠—Ç–æ –Ω–µ –≥–µ–æ–ø–æ–∑–∏—Ü–∏—è. –ù–∞–∂–º–∏—Ç–µ 'üìç –û—Ç–ø—Ä–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ'..." - –µ—Å–ª–∏ –≤–æ–¥–∏—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω
- –ú–æ–ª—á–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º - –µ—Å–ª–∏ –≤–æ–¥–∏—Ç–µ–ª—å –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω

## Cron –∑–∞–¥–∞—á–∏

### –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ (09:00 –ø–æ TZ)

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** `'40 18 * * *'` (18:40 UTC = 09:00 –ø–æ Europe/Vilnius)

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–æ–¥–∏—Ç–µ–ª–µ–π: `db.getActiveDrivers()`
2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –≤ —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ –∞–¥–º–∏–Ω–∞: `db.getTodayInAdminTimezone()`
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–¥–∏—Ç–µ–ª—è:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞, –±—ã–ª –ª–∏ –Ω–∞–ø–æ–º–Ω–µ–Ω —Å–µ–≥–æ–¥–Ω—è: `db.wasRemindedToday(chatId)`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –º–∞—Ä—à—Ä—É—Ç–∞ (–ø—Ä–æ–ø—É—Å–∫ –µ—Å–ª–∏ `stopped`)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞ –ø–æ–µ–∑–¥–∫–∏ (–ø—Ä–æ–ø—É—Å–∫ –µ—Å–ª–∏ –µ—â–µ –Ω–µ –Ω–∞—Å—Ç—É–ø–∏–ª–∞)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–µ–∑–¥–∫–∏:
     - –ï—Å–ª–∏ –∏—Å—Ç–µ–∫–ª–∞ ‚Üí –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞: `endRoute()`
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª—é
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `last_reminded_date`: `db.markRemindedToday(chatId)`

**–í—ã–∑–æ–≤—ã –ë–î:**
- `db.getActiveDrivers()` - SELECT –∏–∑ `drivers` WHERE `route_status IN ('in-progress', 'not-started-yet')` AND `telegram_chat_id IS NOT NULL`
- `db.getTodayInAdminTimezone()` - SELECT `timezone` –∏–∑ `admin_settings`
- `db.wasRemindedToday(chatId)` - SELECT `last_reminded_date` –∏–∑ `drivers` WHERE `telegram_chat_id = ?`
- `db.markRemindedToday(chatId)` - UPDATE `drivers` SET `last_reminded_date = today`
- `endRoute()` ‚Üí `db.setDriverRouteStatus()` - UPDATE `drivers`
- `db.setDriverInactive(chatId)` - UPDATE `drivers` SET `is_active = false` (–µ—Å–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –±–æ—Ç)

**–ó–∞–ø–∏—Å–∏ –≤ –ë–î:**
```sql
-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ last_reminded_date
UPDATE drivers 
SET last_reminded_date = CURRENT_DATE 
WHERE telegram_chat_id = ?;
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–µ–∑–¥–æ–∫, –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∏—Ö—Å—è —Å–∫–æ—Ä–æ (08:00 –ø–æ TZ)

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** `'0 8 * * *'` (08:00 UTC)

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ –∞–¥–º–∏–Ω–∞: `db.getAdminTimezone()`
2. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–π –¥–∞—Ç—ã –≤ —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ –∞–¥–º–∏–Ω–∞
3. –ü–æ–∏—Å–∫ –≤–æ–¥–∏—Ç–µ–ª–µ–π —Å `journey_end_date = –∑–∞–≤—Ç—Ä–∞` –∏ `route_status != 'stopped'`
4. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–¥–∏—Ç–µ–ª—è:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞, –±—ã–ª–æ –ª–∏ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: `db.checkJourneyNotificationSent(driver.id, 'ending_soon')`
   - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏: `db.markJourneyNotificationSent(driver.id, 'ending_soon')`

**–í—ã–∑–æ–≤—ã –ë–î:**
- `db.getAdminTimezone()` - SELECT `timezone` –∏–∑ `admin_settings`
- `db.getTodayInAdminTimezone()` - SELECT `timezone` –∏–∑ `admin_settings` (–¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –¥–∞—Ç—ã)
- –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ Supabase: SELECT –∏–∑ `drivers` WHERE `journey_end_date = ?` AND `route_status != 'stopped'`
- `db.checkJourneyNotificationSent(driver.id, 'ending_soon')` - SELECT –∏–∑ `journey_notifications` WHERE `driver_id = ?` AND `notification_type = 'ending_soon'`
- `db.markJourneyNotificationSent(driver.id, 'ending_soon')` - INSERT –≤ `journey_notifications`

**–ó–∞–ø–∏—Å–∏ –≤ –ë–î:**
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
INSERT INTO journey_notifications (driver_id, notification_type, sent_at, created_at)
VALUES (?, 'ending_soon', now(), now());
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ (00:00 –ø–æ TZ)

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** `'0 0 * * *'` (00:00 UTC)

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –≤ —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ –∞–¥–º–∏–Ω–∞: `db.getTodayInAdminTimezone()`
2. –ü–æ–∏—Å–∫ –≤–æ–¥–∏—Ç–µ–ª–µ–π —Å –∏—Å—Ç–µ–∫—à–µ–π –¥–∞—Ç–æ–π: `journey_end_date < today` –∏ `route_status != 'stopped'`
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–¥–∏—Ç–µ–ª—è:
   - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞: `db.setDriverRouteStatus(driver.id, 'stopped')`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: `db.checkJourneyNotificationSent(driver.id, 'ended')`
   - –°–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: `db.markJourneyNotificationSent(driver.id, 'ended')`
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª—é (–µ—Å–ª–∏ –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –±–æ—Ç)

**–í—ã–∑–æ–≤—ã –ë–î:**
- `db.getTodayInAdminTimezone()` - SELECT `timezone` –∏–∑ `admin_settings`
- –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ Supabase: SELECT –∏–∑ `drivers` WHERE `journey_end_date < ?` AND `journey_end_date IS NOT NULL` AND `route_status != 'stopped'`
- `db.setDriverRouteStatus(driver.id, 'stopped')` - UPDATE `drivers` SET `route_status = 'stopped'`, `is_active = false`
- `db.checkJourneyNotificationSent(driver.id, 'ended')` - SELECT –∏–∑ `journey_notifications`
- `db.markJourneyNotificationSent(driver.id, 'ended')` - INSERT –≤ `journey_notifications`

**–ó–∞–ø–∏—Å–∏ –≤ –ë–î:**
```sql
-- –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞
UPDATE drivers 
SET route_status = 'stopped', is_active = false 
WHERE id = ?;

-- –°–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
INSERT INTO journey_notifications (driver_id, notification_type, sent_at, created_at)
VALUES (?, 'ended', now(), now());
```

## –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –ë–î

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

#### `getDriverByChatId(chatId)`
- **–¢–∞–±–ª–∏—Ü–∞:** `drivers`
- **–ó–∞–ø—Ä–æ—Å:** `SELECT * FROM drivers WHERE telegram_chat_id = ?`
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –æ–±—ä–µ–∫—Ç –≤–æ–¥–∏—Ç–µ–ª—è –∏–ª–∏ `null`

#### `getDriverByToken(token)`
- **–¢–∞–±–ª–∏—Ü–∞:** `drivers`
- **–ó–∞–ø—Ä–æ—Å:** `SELECT * FROM drivers WHERE token = ?`
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –æ–±—ä–µ–∫—Ç –≤–æ–¥–∏—Ç–µ–ª—è –∏–ª–∏ `null`

#### `getDriver(id)`
- **–¢–∞–±–ª–∏—Ü–∞:** `drivers`
- **–ó–∞–ø—Ä–æ—Å:** `SELECT * FROM drivers WHERE id = ?`
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –æ–±—ä–µ–∫—Ç –≤–æ–¥–∏—Ç–µ–ª—è –∏–ª–∏ `null`

#### `getDrivers()`
- **–¢–∞–±–ª–∏—Ü–∞:** `drivers`
- **–ó–∞–ø—Ä–æ—Å:** `SELECT * FROM drivers ORDER BY created_at DESC`
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –º–∞—Å—Å–∏–≤ –≤–æ–¥–∏—Ç–µ–ª–µ–π

#### `getActiveDrivers()`
- **–¢–∞–±–ª–∏—Ü–∞:** `drivers`
- **–ó–∞–ø—Ä–æ—Å:** `SELECT * FROM drivers WHERE route_status IN ('in-progress', 'not-started-yet') AND telegram_chat_id IS NOT NULL`
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:** –ø–æ –¥–∞—Ç–∞–º –ø–æ–µ–∑–¥–∫–∏ (–≤ –∫–æ–¥–µ)
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –º–∞—Å—Å–∏–≤ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–æ–¥–∏—Ç–µ–ª–µ–π

#### `hasLocations(driverId)`
- **–¢–∞–±–ª–∏—Ü–∞:** `locations`
- **–ó–∞–ø—Ä–æ—Å:** `SELECT COUNT(*) FROM locations WHERE driver_id = ?`
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `true` –µ—Å–ª–∏ –µ—Å—Ç—å –ª–æ–∫–∞—Ü–∏–∏, `false` –µ—Å–ª–∏ –Ω–µ—Ç

#### `wasRemindedToday(chatId)`
- **–¢–∞–±–ª–∏—Ü–∞:** `drivers`
- **–ó–∞–ø—Ä–æ—Å:** `SELECT last_reminded_date FROM drivers WHERE telegram_chat_id = ?`
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `true` –µ—Å–ª–∏ –Ω–∞–ø–æ–º–Ω–∏–ª–∏ —Å–µ–≥–æ–¥–Ω—è, `false` –µ—Å–ª–∏ –Ω–µ—Ç

#### `checkJourneyNotificationSent(driverId, notificationType)`
- **–¢–∞–±–ª–∏—Ü–∞:** `journey_notifications`
- **–ó–∞–ø—Ä–æ—Å:** `SELECT * FROM journey_notifications WHERE driver_id = ? AND notification_type = ?`
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `true` –µ—Å–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ, `false` –µ—Å–ª–∏ –Ω–µ—Ç

#### `getAdminTimezone()`
- **–¢–∞–±–ª–∏—Ü–∞:** `admin_settings`
- **–ó–∞–ø—Ä–æ—Å:** `SELECT timezone FROM admin_settings LIMIT 1`
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å –∞–¥–º–∏–Ω–∞ –∏–ª–∏ `'Europe/Vilnius'` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

#### `getTodayInAdminTimezone()`
- **–¢–∞–±–ª–∏—Ü–∞:** `admin_settings` (–∫–æ—Å–≤–µ–Ω–Ω–æ)
- **–õ–æ–≥–∏–∫–∞:** –ø–æ–ª—É—á–∞–µ—Ç —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å –∞–¥–º–∏–Ω–∞ –∏–∑ `admin_settings` –∏ –≤—ã—á–∏—Å–ª—è–µ—Ç —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –≤ —ç—Ç–æ–º —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ `YYYY-MM-DD`

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

#### `linkDriverToTelegram(driverId, chatId)`
- **–¢–∞–±–ª–∏—Ü–∞:** `drivers`
- **–ó–∞–ø—Ä–æ—Å:** `UPDATE drivers SET telegram_chat_id = ? WHERE id = ?`
- **–û–±–Ω–æ–≤–ª—è–µ—Ç:** —Ç–æ–ª—å–∫–æ `telegram_chat_id`

#### `activateDriver(driverId, chatId)`
- **–¢–∞–±–ª–∏—Ü–∞:** `drivers`
- **–ó–∞–ø—Ä–æ—Å:** `UPDATE drivers SET telegram_chat_id = ?, route_status = 'in-progress', is_active = true WHERE id = ?`
- **–û–±–Ω–æ–≤–ª—è–µ—Ç:** `telegram_chat_id`, `route_status`, `is_active`

#### `setDriverInactive(chatId)`
- **–¢–∞–±–ª–∏—Ü–∞:** `drivers`
- **–ó–∞–ø—Ä–æ—Å:** `UPDATE drivers SET is_active = false WHERE telegram_chat_id = ?`
- **–û–±–Ω–æ–≤–ª—è–µ—Ç:** —Ç–æ–ª—å–∫–æ `is_active`

#### `setDriverRouteStatus(driverId, status)`
- **–¢–∞–±–ª–∏—Ü–∞:** `drivers`
- **–ó–∞–ø—Ä–æ—Å:** `UPDATE drivers SET route_status = ?, is_active = ? WHERE id = ?`
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:** `is_active = true` –µ—Å–ª–∏ `status = 'in-progress'`, –∏–Ω–∞—á–µ `is_active = false`
- **–û–±–Ω–æ–≤–ª—è–µ—Ç:** `route_status`, `is_active`

#### `markRemindedToday(chatId)`
- **–¢–∞–±–ª–∏—Ü–∞:** `drivers`
- **–ó–∞–ø—Ä–æ—Å:** `UPDATE drivers SET last_reminded_date = CURRENT_DATE WHERE telegram_chat_id = ?`
- **–û–±–Ω–æ–≤–ª—è–µ—Ç:** `last_reminded_date`

### –í—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

#### `saveLocation(driverId, lat, lon)`
- **–¢–∞–±–ª–∏—Ü–∞:** `locations`
- **–ó–∞–ø—Ä–æ—Å:** `INSERT INTO locations (driver_id, latitude, longitude, captured_at) VALUES (?, ?, ?, now())`
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –æ–±—ä–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –ª–æ–∫–∞—Ü–∏–∏

#### `markJourneyNotificationSent(driverId, notificationType)`
- **–¢–∞–±–ª–∏—Ü–∞:** `journey_notifications`
- **–ó–∞–ø—Ä–æ—Å:** `INSERT INTO journey_notifications (driver_id, notification_type, sent_at, created_at) VALUES (?, ?, now(), now())`
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –æ–±—ä–µ–∫—Ç —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### `isNewRoute(driver)`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–æ–∑–¥–∞–Ω –ª–∏ –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –≤–æ–¥–∏—Ç–µ–ª—è.

**–£—Å–ª–æ–≤–∏—è:**
- `route_status = 'not-started-yet'`
- `journey_start_date` –∏ `journey_end_date` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (–Ω–µ NULL)
- `telegram_chat_id` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–≤–æ–¥–∏—Ç–µ–ª—å –±—ã–ª –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω —Ä–∞–Ω–µ–µ)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `true` –µ—Å–ª–∏ –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç, `false` –µ—Å–ª–∏ –Ω–µ—Ç

### `formatDateForDriver(dateStr)`
–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–∞—Ç—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª—é.

**–§–æ—Ä–º–∞—Ç:** `–î–î.–ú–ú.–ì–ì–ì–ì` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `15.12.2024`)

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `dateStr` - –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `YYYY-MM-DD`

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–∞—Ç—É –∏–ª–∏ –∏—Å—Ö–æ–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–µ

### `endRoute(chatId, driverId, reason)`
–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞.

**–õ–æ–≥–∏–∫–∞:**
1. –í—ã–∑–æ–≤ `db.setDriverRouteStatus(driverId, 'stopped')`
2. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `chatId` - ID —á–∞—Ç–∞ –≤–æ–¥–∏—Ç–µ–ª—è
- `driverId` - ID –≤–æ–¥–∏—Ç–µ–ª—è
- `reason` - –ø—Ä–∏—á–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ

## –°—Ç–∞—Ç—É—Å—ã –º–∞—Ä—à—Ä—É—Ç–∞

### `'not-started-yet'`
–ú–∞—Ä—à—Ä—É—Ç –µ—â–µ –Ω–µ –Ω–∞—á–∞—Ç.

**–£—Å–ª–æ–≤–∏—è:**
- –í–æ–¥–∏—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –Ω–æ –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏–ª –ø–µ—Ä–≤—É—é –ª–æ–∫–∞—Ü–∏—é
- –ò–ª–∏ –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç —Å–æ–∑–¥–∞–Ω –∞–¥–º–∏–Ω–æ–º –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ

**is_active:** `false`

### `'in-progress'`
–ú–∞—Ä—à—Ä—É—Ç –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ.

**–£—Å–ª–æ–≤–∏—è:**
- –í–æ–¥–∏—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–∏–ª —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –ª–æ–∫–∞—Ü–∏—é
- –ú–∞—Ä—à—Ä—É—Ç –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –Ω–µ –∏—Å—Ç–µ–∫–ª–∞

**is_active:** `true`

### `'stopped'`
–ú–∞—Ä—à—Ä—É—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.

**–£—Å–ª–æ–≤–∏—è:**
- –í–æ–¥–∏—Ç–µ–ª—å –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É "–ú–∞—Ä—à—Ä—É—Ç –∑–∞–≤–µ—Ä—à—ë–Ω"
- –ò–ª–∏ –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–µ–∑–¥–∫–∏ –∏—Å—Ç–µ–∫–ª–∞
- –ò–ª–∏ –º–∞—Ä—à—Ä—É—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**is_active:** `false`

## –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è is_active —Å route_status

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `setDriverRouteStatus()`:

- `route_status = 'in-progress'` ‚Üí `is_active = true`
- `route_status = 'not-started-yet'` ‚Üí `is_active = false`
- `route_status = 'stopped'` ‚Üí `is_active = false`

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –û—à–∏–±–∫–∏ Telegram API

**–ö–æ–¥ 403 (Forbidden):**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–ª—á–∞–ª–∏–≤–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ

**–ö–æ–¥ 409 (Conflict):**
- –î—Ä—É–≥–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ —É–∂–µ –∑–∞–ø—É—â–µ–Ω
- –û–±—Ä–∞–±–æ—Ç–∫–∞: –≤—ã–≤–æ–¥ –æ—à–∏–±–∫–∏ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞

### –û—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**PGRST116 (Not Found):**
- –ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞: –≤–æ–∑–≤—Ä–∞—Ç `null` –∏–ª–∏ `false`

**PGRST204 (Column Not Found):**
- –ö–æ–ª–æ–Ω–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–¥–ª—è `last_reminded_date`)
- –û–±—Ä–∞–±–æ—Ç–∫–∞: –≤–æ–∑–≤—Ä–∞—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–î—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏:**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –¥–∞–ª—å—à–µ

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏:

- `[BOOT]` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
- `[UPDATE]` - –≤—Ö–æ–¥—è—â–∏–µ update'—ã
- `[START]` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã `/start`
- `[LOCATION]` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–∫–∞—Ü–∏–∏
- `[ROUTE_END]` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞
- `[CRON]` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ cron –∑–∞–¥–∞—á
- `[BOT]` - –æ–±—â–∏–µ –æ—à–∏–±–∫–∏ –±–æ—Ç–∞
- `[TEXT]` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

## –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã

### `keyboard`
–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –≤–æ–¥–∏—Ç–µ–ª–µ–π:
- "üìç –û—Ç–ø—Ä–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ" (location request)
- "‚úÖ –ú–∞—Ä—à—Ä—É—Ç –∑–∞–≤–µ—Ä—à—ë–Ω"

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- `resize()` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞
- `persistent()` - –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞

### `removeKeyboard`
–£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–∞).

## –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–æ–¥–∏—Ç–µ–ª—è
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /start <token> ‚Üí –ü–æ–∏—Å–∫ –≤–æ–¥–∏—Ç–µ–ª—è ‚Üí –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Å Telegram ‚Üí –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ –ª–æ–∫–∞—Ü–∏–∏
```
–í–æ–¥–∏—Ç–µ–ª—å ‚Üí –õ–æ–∫–∞—Ü–∏—è ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É ‚Üí –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
```

### –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞
```
–í–æ–¥–∏—Ç–µ–ª—å ‚Üí –ö–Ω–æ–ø–∫–∞ "–ú–∞—Ä—à—Ä—É—Ç –∑–∞–≤–µ—Ä—à—ë–Ω" ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ ‚Üí –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã ‚Üí –°–æ–æ–±—â–µ–Ω–∏–µ
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
```
Cron (09:00) ‚Üí –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–æ–¥–∏—Ç–µ–ª–µ–π ‚Üí –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è ‚Üí –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ last_reminded_date
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
```
Cron (00:00) ‚Üí –ü–æ–∏—Å–∫ –≤–æ–¥–∏—Ç–µ–ª–µ–π —Å –∏—Å—Ç–µ–∫—à–µ–π –¥–∞—Ç–æ–π ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ ‚Üí –°–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚Üí –°–æ–æ–±—â–µ–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª—é
```

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```json
{
  "@supabase/supabase-js": "^2.81.1",
  "dotenv": "^17.2.2",
  "node-cron": "^4.2.1",
  "telegraf": "^4.16.3"
}
```

## –ó–∞–ø—É—Å–∫

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
npm start
# –∏–ª–∏
node bot.js
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤

- `SIGINT` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–∏ Ctrl+C
- `SIGTERM` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–æ—Ü–µ—Å—Å–∞

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- RLS (Row Level Security) –≤–∫–ª—é—á–µ–Ω –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
- –¢–æ–∫–µ–Ω—ã –≤–æ–¥–∏—Ç–µ–ª–µ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π

## –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

–ë–æ—Ç –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è:
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ `BOT.command()`
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —á–µ—Ä–µ–∑ `BOT.on()`
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö cron –∑–∞–¥–∞—á —á–µ—Ä–µ–∑ `cron.schedule()`
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –≤ `lib/db.js`

